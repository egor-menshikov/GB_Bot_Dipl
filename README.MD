# Телеграм бот для дипломной работы GB.

### <u>Порядок моих действий.</u>

1) В telegram подключаемся к https://t.me/BotFather, создаем нового бота, выбираем отображаемое имя и имя пользователя.
   Получаем токен доступа к API.
2) Создаем проект в python, устанавливаем фреймворк aiogram, устанавливаем библиотеку python-dotenv.
3) Пишем самый минимальный функционал бота: инициализируем бота и диспетчер(обработчик обновлений, которые бот получает
   с сервера telegram), запускаем прослушку обновлений с сервера telegram,
   прорабатываем реакции на команду */start*, и на простые сообщения вроде *hi*, *bye*.
4) Задействуем dotenv.
5) Вынес хэндлеры в отдельный модуль, добавил пару тестовых команд, создал роутеры для группы и приватных сообщений.
6) Добавил фильтры сообщений в эти роутеры.

### <u>Заметки.</u>

##### [asyncio](https://docs.python.org/3/library/asyncio.html)

Модуль для создания асинхронных приложений.

* ```async def ...``` Превращает функцию в Coroutine - позволяет функции работать одновременно с другими.
* ```await ...``` Говорит Coroutine где можно встать на паузу и передать контроль другой Coroutine. Ставится только
  перед Awaitable командами.

##### [aiogram](https://docs.aiogram.dev/en/latest/)

Асинхронный фреймворк для создания телеграм ботов.

* ```await bot.delete_webhook(drop_pending_updates=True)``` При развертывании на сервере (когда у бота есть свой url),
  нужно чтобы бот не отвечал на те сообщения, которые пришли, когда он был офлайн.
* ```await message.(answer/reply/send_message(id, text))``` Разные способы отправки сообщений.
* ```@dp.message()``` (Где dp - диспетчер бота) Насколько я понял, заворачиваем наши асинхронные функции в данный
  декоратор, и они будут работать, в данном случае, при получении апдейта типа Message с telegram-сервера. Список
  возможных событий можно посмотреть в официальной документации к telegram ботам.
* Боту можно задавать его возможные команды, которые появятся в кнопке меню и область действия для них (
  scope). ```bot.set_my_commands(commands=список_команд, scope=types.область)```. Если нужно их удалить, то
  используем ```bot.delete_my_commands(scope)```.
* Команда BotCommand состоит из имени и описания, например ```BotCommand(command='menu', description='Открыть меню')```.
* ```from aiogram import F``` [Магический фильтр.](https://docs.aiogram.dev/en/latest/dispatcher/filters/magic_filters.html)
  Пример
  использования: ```@user_private_rt.message(F.text == 'текст')```. В данном случаем мы через атрибуты F получаем доступ
  к полям Message. Из того, что запомнилось - ```~``` - инвертирует результат, т.е. "все, кроме этого
  условия". ```or_f(variants)``` - 'или'.
* [Создание фильтров.](https://docs.aiogram.dev/en/latest/dispatcher/filters/index.html)
* Можно получать от бота экранное меню (клавиатуру) с кнопками, для этого в параметр сообщения ```reply_markup```
  добавляем экземпляр ```ReplyKeyboardMarkup```, в который передаем названия кнопок в формате список списков (по рядам).
  Эти названия будут восприниматься как вводимые сообщения.
* Второй способ добавления клавиатуры - ```ReplyKeyboardBuilder()```. При передаче дополнительно вызвать
  метод ```as_markup()```. Такую клавиатуру можно достраивать от любой другой: ```new_kb.attach(old_kb)```, и дальше
  добавлять новые кнопки.
* Можно запрашивать локацию, телефон, создавать голосования, при указании опций ```request...``` после текста кнопки.
* [Форматирование текста.](https://docs.aiogram.dev/en/latest/utils/formatting.html) ```TODO```

##### [python-dotenv](https://github.com/theskumar/python-dotenv)

Небольшой пакет, который считывает пары ключ-значение из файла .env, и загружает необходимые вашему
приложению переменные среды.

* Прячем токен бота в файл '.env', хранящийся локально.
* ```load_dotenv(find_dotenv())``` Выгружаем переменные из файла в переменные окружения. Достается такая переменная при
  помощи ```os.getenv(name)```.

### <u>Ссылки на материалы.</u>

* [Плейлист по созданию ботов в telegram от Python Hub Studio](https://www.youtube.com/playlist?list=PLNi5HdK6QEmWLtb8gh8pwcFUJCAabqZh_)